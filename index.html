<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>MiniApp Packaging</title>
    <script async class="remove" src="https://www.w3.org/Tools/respec/respec-w3c"></script>
    <script class="remove">
        var respecConfig = {
            specStatus: "ED",
            copyrightStart: "2021",
            edDraftURI: "https://w3c.github.io/miniapp-packaging/",

            shortName: "miniapp-packaging",

            editors: [
                {
                    name: "Martin Alvarez-Espinar",
                    companyURL: "https://www.huawei.com",
                    company: "Huawei",
                    w3cid: 125049,
                },          
                {
                    name: "Qing An",
                    companyURL: "https://www.alibabagroup.com/en/global/home",
                    company: "Alibaba",
                    w3cid: 76701,
                },
                {
                    name: "Tengyuan Zhang",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc",
                    w3cid: 118561,
                },         
                {
                    name: "Yongjing Zhang",
                    companyURL: "https://www.huawei.com/",
                    company: "Huawei",
                    w3cid: 75048,
                }, 
                {
                    name: "Dan Zhou",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc",
                    w3cid: 118521,
                }
            ],
            formerEditors: [
                {
                    name: "Shouren Lan",
                    companyURL: "https://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Zhiqiang Yu",
                    companyURL: "https://www.huawei.com/",
                    company: "Huawei"
                }, 
                {
                    name: "Qian Liu",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }, 
                {
                    name: "Shuo Wang",
                    companyURL: "https://www.baidu.com/",
                    company: "Baidu, Inc"
                }
            ],
            group: "wg/miniapps",
            github: {
                repoURL: "https://github.com/w3c/miniapp-packaging",
                branch: "main",
            },
            localBiblio: {
                "APK-SIGNATURE-V2": {
                    title: "APK Signature Scheme v2",
                    href: "https://source.android.com/security/apksigning/v2"
                },
                "CSS-SNAPSHOT": {
                    title: "CSS Snapshot",
                    href: "https://www.w3.org/TR/CSS/"
                },
                "MINIAPP-ADDRESSING": {
                    title: "MiniApp Addressing",
                    href: "https://w3c.github.io/miniapp-addressing/"
                }
            },
            a11y: true,            
        };
    </script>
</head>

<body data-cite="MINIAPP-MANIFEST INFRA URL HTML">
    <section id="abstract">
        <p>This specification defines semantics and conformance requirements for a [=MiniApp package=], and the structure of the single file container that holds the resources of a MiniApp, including a manifest file, static page templates, stylesheets, JavaScript documents, media files and other resources. Instances of the [=MiniApp package=] are used for MiniApp distribution and execution on runtime environments ([=MiniApp user agent=]).</p>
    </section>
    <section id="sotd">
    </section>
    <section id="sec-introduction">
        <h2>Introduction</h2>
        <section>
            <h3>Overview</h3>
            <p>[=MiniApp=] is a concept of light software application, that can be distributed through any digital means, and accessed through the Web. MiniApps are defined by a concrete file structure and all their resources are packed within a single file that represents the whole [=MiniApp package=] that can be processed and executed by [=MiniApp user agents=].</p>
            <p>A [=MiniApp package=] contains a directory structure that holds the specific resources of the MiniApp that defines the rendering, operation, and interaction with the end-users — including static page templates, stylesheets, JavaScript documents, media files, and other resources — and the manifest. The <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a>, located in the central directory of the package, describes the MiniApp, including information about page routing, styles, and other operational and rendering details of the MiniApp, as well as descriptive information for humans.</p>
            <p>As defined in <a href="#sec-security-privacy">Security and Privacy Considerations</a>, MiniApps MAY support [=digital signature=] verification to guarantee the integrity of the package and contents during the delivery of the package.</p>
            <p>The MiniApp runtime environment ([=MiniApp user agent=]) identifies MiniApp package files through the standard [=MiniApp package=] format and the specific MIME media type, defined in this document. After retrieving the [=MiniApp ZIP container=], the [=MiniApp user agent=] loads the static page templates, stylesheets, JavaScript files, and other resources into the cache, following a <a href="#sec-miniapp-processing">dereference and processing algorithm</a>. These [=MiniApp resources=] will remain available in the cache until the next update, avoiding unnecessary network fetches.</p>
            <p>In terms of launch mode, a MiniApp can be launched normally when offline. The [=MiniApp user agent=] locates the specified [=start page=] from the package cache path and launches the MiniApp according to the description set out in the <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a> file.</p>
        </section>
        <section id="sec-terminology">
            <h3>Terminology</h3>
            <p>The following terms are specific to MiniApps.</p>
            <dl class="termlist">
                <dt><dfn id="dfn-signature" data-lt="signatures|signature|digital signature|digital signatures" data-dfn-type="dfn">Digital signature</dfn></dt>
                <dd>A cryptographic mechanism and hashing techniques to prove the authenticity of [=resources=]. Digital signatures can demonstrate the origin, time, identity, and status of [=resources=] and of the [=MiniApp package=].</dd>
                <dt><dfn id="dfn-filename" data-lt="file name|file names" data-dfn-type="dfn">File name</dfn></dt>
                <dd>The name of any file within a [=MiniApp package=], either a directory or a file within a directory.</dd>
                <dt><dfn data-export="" id="dfn-miniapp" data-lt="MiniApps" data-dfn-type="dfn">MiniApp</dfn></dt>
                <dd>A light software application, that can be distributed through any digital means, and accessed through the Web. MiniApps are defined by a concrete file structure, distributed within a single file [=MiniApp ZIP container=] that represents the whole [=MiniApp package=] that can be processed and executed by [=MiniApp user agents=].</dd>
                <dt><dfn id="dfn-package" data-lt="MiniApp package|MiniApp packages|package" data-dfn-type="dfn">MiniApp package</dfn></dt>
                <dd>A logical document entity composed of a set of [=resources=] packaged in a [=MiniApp ZIP container=].</dd>
                <dt><dfn id="dfn-resource" data-lt="resources|resource|MiniApp resources" data-dfn-type="dfn">MiniApp resource</dfn></dt>
                <dd>A logical document that is part of the view or the logic of a MiniApp. Resources are included physically in [=MiniApp packages=].</dd>
                <dt><dfn id="dfn-page" data-lt="pages|page|MiniApp pages" data-dfn-type="dfn">MiniApp page</dfn></dt>
                <dd>A collection of information that is displayed in a [=MiniApp user agent=], under the scope of a specific MiniApp. </dd>
                <dt><dfn id="dfn-useragent" data-lt="user agents|user agent|MiniApp user agents" data-dfn-type="dfn">MiniApp user agent</dfn></dt>
                <dd>A software application that gets, process and renders [=MiniApp packages=], enabling execution and end-user interaction with MiniApps.</dd>
                <dt><dfn id="dfn-container" data-lt="ZIP container|ZIP containers|MiniApp ZIP containers" data-dfn-type="dfn">MiniApp ZIP container</dfn></dt>
                <dd>The ZIP-based packaging and distribution format for MiniApps, as defined in <a href="#sec-miniapp-zip-container">MiniApp ZIP container</a> section.</dd>
                <dt><dfn data-export="" id="dfn-widget" data-lt="widget|widgets|MiniApp widgets" data-dfn-type="dfn">MiniApp widget</dfn></dt>
                <dd>A special type of [=MiniApp page=] that is displayed standalone in host environments such as assistants and device search pages to connect MiniApp services in specific scenarios.</dd>
                <dt><dfn id="dfn-start-page" data-lt="MiniApp start pages|start page|start pages" data-dfn-type="dfn">MiniApp start page</dfn></dt>
                <dd>The entry point of a MiniApp. The resource that is loaded and rendered by the [=MiniApp user agent=] at the launch of the application.</dd>  
            </dl>
        </section>
        <section id="conformance">
            The MiniApp Packaging specification depends on the Infra Standard [[INFRA]] to describe algorithms.
        </section>
    </section>

    <section id="sec-conformance">
        <h2>Package Conformance</h2>
        <p>A conformant [=MiniApp package=] MUST meet the following criteria:</p>
        <ul class="conformance-list">
            <li>The file system of a package MUST have a file structure based on a [=root directory=] and the <a href="#sec-pages-directory"><code>pages</code> subdirectory</a>.</li>
            <li>The [=root directory=] MAY include a subdirectory <code>common</code> to store resources available at application level.</li>
            <li>The [=root directory=] SHOULD include a subdirectory <code>i18n</code> to store [=localization resources=] for internationalization purposes.</li>
            <li>The [=root directory=] MUST contain one configuration file, named <code>manifest.json</code>, to describe and configure the runtime environment as defined in the <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a> specification [[MINIAPP-MANIFEST]].</li>
            <li>The [=root directory=] MUST contain one script document, named <code>app.js</code>, with the basic control logic of the MiniApp. </li>
            <li>The [=root directory=] MUST contain one stylesheet, named <code>app.css</code>, following a syntax, structure and format as defined in the <a href="#sec-miniapp-resources-css">CSS Resources</a> section.</li>
            <li>The whole [=MiniApp package=] MUST be wrapped as a [[ZIP]] file, according to the requirements of [=MiniApp ZIP containers=].</li>
            <li>The file system of a package MAY contain other subdirectories and files of different nature as defined in the <a href="#sec-filestructure">Directory and File System Structure</a> section.</li>
        </ul>
        <section id="sec-filestructure">
            <h3>Directory and File System Structure</h3>
            <p>The [=MiniApp package=] has a file structure with some restrictions and reserved files and subdirectories.</p> 
            <p>The following example shows a typical file system structure:</p>
            <pre class="example" title="File sytem structure">
                /
                |___manifest.json
                |___app.js
                |___app.css
                |___pages/
                |       |___page1.js
                |       |___page1.html
                |       |___page1.css
                |___common/
                |       |___componentA.js
                |       |___componentA.html
                |       |___componentA.css
                |       |___example.png
                |___i18n/
                        |___zh-Hans.json
                        |___en-US.json
            </pre>
            <section>
                <h3>Root Directory</h3>
                <p>The <dfn id="dfn-root-directory" data-lt="root directory|root directories|MiniApp root directories" data-dfn-type="dfn">MiniApp root directory</dfn> is the base directory of the [=MiniApp package=] file system.</p> 

                <p>The [=root directory=] of a [=MiniApp package=] holds several reserved files that include global data and information about the lifecycle management of the MiniApp, including:</p>
                <dl data-cite="MINIAPP-MANIFEST">
                    <dt><code>manifest.json</code></dt>
                    <dd>The <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a> is a JSON document responsible for the global configuration of the MiniApp. A manifest file contains a collection of mandatory and optional attributes that indicate the setup of the MiniApp, including routes and paths of the pages and the window configuration of the MiniApp (e.g., styles of the navigation bar, background image, background color, page title, among others), according to the MiniApp Manifest specification [[MINIAPP-MANIFEST]].</dd>
                    <dt><code>app.css</code></dt>
                    <dd>This file is the main stylesheet of the application, where developers define common styles and look and feel aspects of the [=pages=] within the MiniApp. It MAY be empty.</dd>
                    <dt><code>app.js</code></dt>
                    <dd>This script document has the basic service logic of the MiniApp and includes the essential configuration and control of the MiniApp lifecycle [[MINIAPP-LIFECYCLE]], including the management of events for launching, showing, and hiding the MiniApp.</dd>
                </dl>
            </section>
            <section id="sec-pages-directory">
                <h3><code>pages</code> Directory</h3>
                <p>The <code>pages</code> directory contains a set of files for the display and user interaction of the [=MiniApp pages=].</p>
                <p>A [=MiniApp page=] is defined by a set of [=resources=], whose files are identified by a unique filename (e.g., <code>intro</code>) and a specific extension that defines the [=resource=] type, such as the business logic of the application (e.g., <code>intro.js</code>), the structure and content (e.g., <code>intro.html</code>), and the scoped stylesheet (e.g., <code>intro.css</code>).</p>
                <p>Developers MAY include other types of [=resources=] according to their needs. Also, the files related to a page (identified with the same filename) MAY be organized either in specific subdirectories for each page or stored under the <code>pages</code> directory directly.</p>
                <pre class="example" title="Page resources directly in the pages directory">
                    /
                    |___manifest.json
                    |___app.js
                    |___app.css
                    |___pages/
                            |___detail.js
                            |___detail.html
                            |___detail.css
                            |___list.js
                            |___list.html
                            |___list.css
                </pre>                
                <pre class="example" title="Page resources organized in subdirectories">
                    /
                    |___manifest.json
                    |___app.js
                    |___app.css
                    |___pages/
                            |___detail/
                                    |___detail.js
                                    |___detail.html
                                    |___detail.css
                            |___list
                                    |___list.js
                                    |___list.html
                                    |___list.css
                </pre>                
                <ul>
                    <li>A <code>.html</code> resource defines the structure and content of a [=MiniApp page=]. Based on HTML, the syntax, structure, and other requirements of this type of file are defined in the <a href="#sec-miniapp-resources-html">HTML Resources</a> section.</li>
                    <li>A <code>.css</code> resource defines the stylesheet of a [=MiniApp page=]. The syntax, structure, and other requirements of this type of resource are defined in the <a href="#sec-miniapp-resources-css">CSS Resources</a> section.</li>
                    <li>A <code>.js</code> resource contains the business logic of the [=MiniApp page=], including functions, data, and other configuration aspects needed for the operation of the application. This type of resource is responsible for the setup and lifecycle management of [=MiniApp pages=], as defined in the MiniApp Lifecycle specification [[MINIAPP-LIFECYCLE]]. The syntax and format of these types of files are defined in the <a href="#sec-miniapp-resources-js">Scripting Resources</a> section.</li>
                </ul>
            </section>
            <section>
                <h3><code>common</code> Directory</h3>
                <p>The optional <code>common</code> directory contains [=resources=], such as components, multimedia resources, documents and libraries that are accessible from the [=pages=] in a MiniApp. The internal structure of this directory is flexible, so these common resources MAY be organized in customized subdirectories and using different name conventions, as needed.</p>
            </section>
            <section>
                <h3><code>i18n</code> Directory</h3>
                <p>The optional <dfn id="dfn-i18n-directory" data-dfn-type="dfn">i18n directory</dfn> is a subdirectory in the [=root directory=] that includes the [=localization resources=] of a [=MiniApp package=].</p>
                <p>The [=i18n Directory=] contains multi-language [=localization resources=] to support the internationalization of the MiniApp contents. The filename of each <code>.json</code> document in this directory follows the <code>Language-Tag</code> notation as defined in [[BCP47]] and represents the specific configuration for that particular language.</p>
                <p>The [=i18n Directory=] MAY contain as many [=localization resources=] as languages or locales a MiniApp supports. The format of these files is defined in the <a href="#sec-miniapp-resources-i18n">localization resources</a> section.</p> 
            </section>
            <section>
                <h3>File Names</h3>
                <p>Any [=file name=] within a [=MiniApp package=] MUST comply with the following restrictions to accommodate the potential limitations of the operating systems and facilitate compatibility with the majority of the platforms:</p>

                <ul class="conformance-list">
                    <li>[=File names=] are case sensitive.</li>
                    <li>[=File names=] MUST be UTF-8 [[Unicode]] encoded.</li>
                    <li>[=File names=] MUST NOT exceed 255 bytes.</li>
                    <li>The path name for any directory or file within a [=MiniApp package=] MUST NOT exceed 65535 bytes.</li>
                    <li>[=File names=] MUST NOT use the following [[Unicode]] characters:
                        <ul>
							<li>
								<p>SOLIDUS: <code>/</code> (<code>U+002F</code>)</p>
							</li>
							<li>
								<p>QUOTATION MARK: <code>"</code> (<code>U+0022</code>)</p>
							</li>
							<li>
								<p>ASTERISK: <code>*</code> (<code>U+002A</code>)</p>
							</li>
							<li>
								<p>FULL STOP as the last character: <code>.</code> (<code>U+002E</code>)</p>
							</li>
							<li>
								<p>COLON: <code>:</code> (<code>U+003A</code>)</p>
							</li>
							<li>
								<p>LESS-THAN SIGN: <code>&lt;</code> (<code>U+003C</code>)</p>
							</li>
							<li>
								<p>GREATER-THAN SIGN: <code>&gt;</code> (<code>U+003E</code>)</p>
							</li>
							<li>
								<p>QUESTION MARK: <code>?</code> (<code>U+003F</code>)</p>
							</li>
							<li>
								<p>REVERSE SOLIDUS: <code>\</code> (<code>U+005C</code>)</p>
							</li>
							<li>
								<p>VERTICAL LINE: <code>\</code> (<code>U+007C</code>)</p>
							</li>
							<li>
								<p>DEL (<code>U+007F</code>)</p>
							</li>
							<li>
								<p>C0 range (<code>U+0000 … U+001F</code>)</p>
							</li>
							<li>
								<p>C1 range (<code>U+0080 … U+009F</code>)</p>
							</li>
							<li>
								<p>Private Use Area (<code>U+E000 … U+F8FF</code>)</p>
							</li>
							<li>
								<p>Non characters in Arabic Presentation Forms-A (<code>U+FDD0 … U+FDEF</code>)</p>
							</li>
							<li>
								<p>Specials (<code>U+FFF0 … U+FFFF</code>)</p>
							</li>
							<li>
								<p>Tags and Variation Selectors Supplement (<code>U+E0000 … U+E0FFF</code>)</p>
							</li>
							<li>
								<p>Supplementary Private Use Area-A (<code>U+F0000 … U+FFFFF</code>)</p>
							</li>
							<li>
								<p>Supplementary Private Use Area-B (<code>U+100000 … U+10FFFF</code>)</p>
							</li>
                        </ul>
                    </li>
                </ul>
                <p id="filename-normalization">All [=file names=] within the same directory MUST be unique following Unicode canonical normalization [[UAX15]] and then full case folding [[Unicode]]. (Refer to <a href="https://www.w3.org/TR/charmod-norm/#CanonicalFoldNormalizationStep">Unicode Canonical Case Fold Normalization Step</a> [[?CHARMOD-NORM]] for more information.)</p>                
                <div class="note" title="Limiting the length of file names">
                    If a MiniApp vendor imposes length limits on path and [=file names=], it is important to avoid mid-character truncation due to the difference between bytes and characters in multibyte encodings such as UTF-8. See <a href="https://www.w3.org/TR/international-specs/#char_truncation">the text truncation best practice</a> for more information.     
                </div>
            </section>
        </section>
        <section id="sec-miniapp-resources">
            <h3>MiniApp Resources</h3>
            <p>A [=MiniApp page=] is composed of, at least, an [=HTML resource=] and, optionally, a [=CSS resource=] and/or a [=scripting resource=]. These related resources MUST have the same path and filename (only changing the file extension) to identify the [=MiniApp page=] through a unique <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-page-route" data-link-type="dfn">page route</a> that needs to be specified in the <a href="https://www.w3.org/TR/miniapp-manifest/#pages-member" data-link-type="dfn"><code>pages</code> member</a> of the <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a> [[MINIAPP-MANIFEST]]. </p>
            <pre class="example" title="Organization of page resources corresponding to the page route 'pages/product/product'">
                    /
                    |___pages/
                            |___product/
                                    |___product.html
                                    |___product.css
                                    |___product.js
            </pre>
            <section id="sec-miniapp-resources-html">
                <h3>HTML Resources</h3>
                <p><dfn id="dfn-html-resource" data-lt="MiniApp HTML resource|MiniApp HTML resources|HTML resource" data-dfn-type="dfn">HTML resources</dfn> are documents that contain markup and information to define [=MiniApp pages=], and their user interfaces, including the structure, visual components, and interaction elements.</p>
                <p>[=HTML resources=] MUST meet all the following criteria:</p>
                <dl class="conformance-list">
                    <dt>Syntax and content</dt>
                    <dd>An [=HTML resource=] MUST use the <a href="https://html.spec.whatwg.org/multipage/syntax.html#syntax">HTML syntax</a> defined in [[HTML]].</dd>
                    <dt>File name</dt>
                    <dd>An [=HTML resource=] SHOULD have a unique filename that identifies a single [=MiniApp page=] and matches with the corresponding [=CSS resource=] and [=scripting resource=] of the page if present.</dd>
                    <dt>File extension</dt>
                    <dd>An [=HTML resource=] SHOULD use the file extension <code>.html</code>.</dd>
                </dl>
                <div class="ednote">
                    To define the HTML profile of MiniApp Content Documents.
                </div> 
            </section>
            <section id="sec-miniapp-resources-css">
                <h3>CSS Resources</h3>
                <p><dfn id="dfn-css-resource" data-lt="MiniApp CSS resource|MiniApp CSS resources" data-dfn-type="dfn">CSS resources</dfn> are stylesheets that describe the rendering and appearance of [=MiniApp pages=]. CSS resources can be global, affecting all the pages in a MiniApp (i.e., <code>app.css</code> in the [=root directory=]), or with local scope, just affecting a specific [=page=] in the MiniApp.</p>
                <p>This specification supports the CSS modules as defined in the [[CSS-SNAPSHOT]].</p>
                <p>CSS resources MUST meet all the following criteria:</p>
                <dl class="conformance-list">                    
                    <dt>Syntax and content</dt>
                    <dd>A [=CSS resource=] MUST follow described using the syntax and definitions of CSS as described in the [[CSS-SNAPSHOT]].</dd>
                    <dt>File name</dt>
                    <dd>The global [=CSS resource=], affecting all [=pages=] in a MiniApp, MUST be named <code>app.css</code> and stored in the [=root directory=].</dd>
                    <dd>A local [=CSS resource=] associated with a [=page=] SHOULD have a unique filename that identifies the [=MiniApp page=] and matches with the corresponding [=HTML resource=] and [=scripting resource=] if present.</dd>
                    <dt>File extension</dt>
                    <dd>A [=CSS resource=] filename SHOULD use the file extension <code>.css</code>.</dd>
                </dl>
            </section>
            <section id="sec-miniapp-resources-js">
                <h3>Scripting Resources</h3>
                <p><dfn id="dfn-js-resource" data-lt="MiniApp scripting resource" data-dfn-type="dfn">Scripting resources</dfn> are documents that contain script elements and data to control the business logic and functionality of the application, adding interactivity and managing the lifecycle of the MiniApp. There is a global [=scripting resource=] (i.e., <code>app.js</code> in the [=root directory=]) that includes data and functions available for all the [=pages=] of the MiniApp, and with specific logic to control the application's lifecycle. Each [=MiniApp page=] MAY have associated specific [=scripting resources=], with the scope limited to the concrete [=page=].</p>
                <p>Scripting resources MUST meet all the following criteria:</p>
                <dl class="conformance-list">
                    <dt>Syntax and content</dt>
                    <dd>The [=scripting resources=] MUST conform with the requirements of the ECMAScript specification [[ECMA-262]].</dd>
                    <dd>The global [=scripting resource=] MUST be named <code>app.js</code> and stored in the [=root directory=].</dd>
                    <dd>A local [=scripting resource=] associated with a [=page=] SHOULD have a unique filename that identifies the [=MiniApp page=] and matches with the corresponding [=HTML resource=] and [=CSS resource=] if present.</dd>
                    <dt>File extension</dt>
                    <dd>A [=scripting resource=] filename SHOULD use the file extension <code>.js</code>.</dd>
                </dl>
            </section>
            <section id="sec-miniapp-resources-i18n">
                <h3>Localization Resources</h3>
                <p>A <dfn id="dfn-localization-resources" data-lt="MiniApp localization resources|Localization resources|localization resources" data-dfn-type="dfn">MiniApp localization resource</dfn> is a document of a [=MiniApp package=] that included localized content as part of the [=internationalization=] mechanism of MiniApps.</p>
                <p>A multilingual MiniApp MAY has several [=localization resources=] that will be used during the [=localization=] process by the [=user agents=] to render content according to the system locale or the user's language preferences. These resources contain JSON objects with key-value pairs that contain the unique identifier (the key) of a localizable term or expression and the representation in the concrete language (the value).</p>
                <pre class="example" title="Localization resource">
                    {
                        "title": "Cool MiniApp",
                        "about": "About this MiniApp",
                        "intro-page": {
                            "title" : "Introduction",
                            "main" : "This is the body of the page"
                        }
                    }
                </pre>
                <p>[=Localization resources=] MUST meet all the following criteria:</p>
                <dl class="conformance-list">
                    <dt>File extension</dt>
                    <dd>A [=localization resource=] filename SHOULD use the file extension <code>.json</code>.</dd>
                    <dt>Format</dt>
                    <dd>A [=localization resource=] MUST be a valid JSON document [[JSON]].</dd>
                    <dt>Structure</dt>
                    <dd>A [=localization resource=] MUST be composed of key-value pairs. Each key represents a unique identifier for each localizable string (the values).</dd>
                </dl>
            </section>
        </section> 
    </section>
  <section id="sec-miniapp-zip-container">
      <h2>MiniApp ZIP Container</h2>
        <section id="sec-miniapp-zip-container-intro" class="informative">
            <h3>Introduction</h3>
            <p>A [=MiniApp ZIP container=] is a physical single-file representation of a MiniApp that can be used to distribute it in different scenarios, including:</p>
            <ul>
                <li>An organization that stores and lists catalogs of MiniApps (i.e., marketplace);</li>
                <li>A developer that builds a MiniApp and delivers it to a marketplace;</li>
                <li>A developer that shares a MiniApp with the <abbr title="Quality Assurance">QA</abbr> department for testing.</li>
            </ul>
            <p>A [=MiniApp ZIP container=] contains all the resources that conforms a MiniApp, according to the [=MiniApp package=] structure in a single file. This format supports the use of compression mechanisms.</p>
        </section>
        <section id="sec-miniapp-zip-file-requirements">
            <h3>ZIP File Requirements</h3>
            <p>A [=MiniApp ZIP container=] uses the ZIP format as defined in [[ZIP]], including some particularities:</p>
        	<ul class="conformance-list">
                <li>The contents of the [=MiniApp ZIP container=] MUST be a conforming [=MiniApp package=].</li>
                <li>MiniApp ZIP containers MUST NOT use the ZIP encryption mechanisms.</li>
                <li>Data integrity MUST be provided for each file using CRC32 as specified in [[ZIP]].</li>
                <li>MiniApp ZIP containers MUST NOT use the features in the ZIP application note [[ZIP]] that allow ZIP files to be spanned across multiple storage media, or split into multiple files.</li>
                <li>MiniApp ZIP containers MUST include ZIP uncompressed (method <code>0</code>, file stored) and Deflate-compressed (method <code>0</code>, lossless data compression) contents within the ZIP archive, according to the [[ZIP]] specification.</li>
                <li>MiniApp ZIP containers MUST use UTF-8 [[Unicode]] for encoding file names.</li>
                <li>MiniApp ZIP containers MUST NOT use patented features.</li>
                <li>MiniApp ZIP containers MAY include a special block, the [=MiniApp signing block=], to allow digital signatures affecting the whole package.</li>
                <li>The minimum version of ZIP to extract a [=MiniApp ZIP container=] is <code>2.0</code> (supporting folders and Deflate compression), according to the [[ZIP]] specification.</li>
            </ul>
            <p>The structure of a MiniApp ZIP container is as follows:</p>
            <pre>
    [ZIP File Entries]
    [MiniApp Signing Block]    
    [ZIP Central Directory]
    [End of ZIP Central Directory]</pre>

            <figure id="figure-zip-summary">
                <img src="images/signature_zip_summary.svg" alt="Structure of standard ZIP package and the MiniApp package with a signing block in the middle" />
                <figcaption>ZIP package and MiniApp package with an optional signing block</figcaption>
            </figure>

            <p>The [=MiniApp ZIP container=] is parsed by first finding the start of the ZIP Central Directory (locating the ZIP End of Central Directory record at the end of the file, then reading the start offset of the Central Directory from the record). Every [=MiniApp signing block=] MAY include a [=signing block magic numbers=] block, as specified in <a href="#sec-miniapp-digital-signature-requirements">Digital Signature Requirements</a>, to identify the presence of digital signatures. Once the "magic numbers" block is recognized, the [=user agent=] would be able to [=process the digital signatures=] stored in the signing block, in the immediately preceding section of the Central Directory, as shown in <a href="#figure-package-references"></a>.</p>


            <figure id="figure-package-references">
                <img src="images/signature_zip_complete.svg" alt="Structure of standard ZIP package and the MiniApp package with a signing block in the middle and references to the different blocks of the package" />
                <figcaption>ZIP and MiniApp packages with references to the different blocks using relative offset addessing</figcaption>
            </figure>

            <p>MiniApps vendors MAY adopt the digital signature schemes depending on their needs.</p>  
            <p class="ednote" title="To add extension">
                MiniApp files MAY be identified by the .ma file extension although the use of a file extension is not required.
            </p>    
        </section>
        <section id="sec-miniapp-digital-signature-requirements">
            <h3>Digital Signature Requirements</h3>  
            <p>A [=MiniApp ZIP container=] MAY include none, one, or more [=signatures=] to help to detect any changes to the protected parts of the software, guaranteeing the integrity of the MiniApp.</p>
            <p>A <dfn id="dfn-signing_block" data-lt="signing block|MiniApp signing blocks|signing blocks" data-dfn-type="dfn">MiniApp signing block</dfn> is a collection of bytes that contains specific information and metadata about the digital signature that affects a MiniApp, partially or as a whole. The [=signing block=] of a [=MiniApp ZIP container=] MUST be located immediately before the central directory of the ZIP container, in a way that makes it easier to locate the block if exists.</p>
            <p>The <dfn id="dfn-magic-numbers" data-lt="magic numbers" data-dfn-type="dfn">signing block magic numbers</dfn> block is A 16-byte sequence with a unique fingerprint that identifies a digital signature mechanism for a [=MiniApp package=], stored in the signing block of [=MiniApp ZIP container=].</p>
            <p>Although this document does not recommend any specific digital signature mechanism (i.e., hash algorithms, encryption methods, etc.), the [=signing block=], if present, MUST meet the following criteria:</p>
        	<dl class="conformance-list">
                <dt>Signing block magic numbers</dt>
                <dd>A [=signing block=] MUST contains [=signing block magic numbers=], as the preceding block of the Central Directory to identify univocally the type of digital signature included.</dd>
            </dl>
        </section>
    </section>
    <section id="sec-miniapp-i18n">
        <h2>Internationalization</h2>
        <p><dfn id="dfn-i18n" data-lt="internationalization|i18n" >Internationalization</dfn>, abbreviated to <abbr title="internationalization">i18n</abbr>, is the process of designing and developing a product in a way that ensures it can be easily adapted for users from any culture, region, or language.</p>
        <p><dfn id="dfn-localization" data-lt="localization" >Localization</dfn> is the process of content adaptation to meet a target language or cultural requirements.</p>
        <p>MiniApps enable localization of contents using a mechanism based on localized documents placed in the reserved [=i18n Directory=]. This mechanism allows authors to place [=localization resources=], named according to a <code>language-range</code> [[BCP47]] and the <code>.json</code> extension. This is, documents with the localization resources will be identified with language tags [[BCP47]] that represent the locale of the content. [=MiniApp user agents=] match the language ranges held by their locales to the appropriate locale filename.</p>
        <p>The format of the [=localization resources=] is defined in the <a href="#sec-miniapp-resources-i18n">localization resources</a> section.</p>
        <pre class="example" title="Filenames based on language tags in the i18n directory">
                /
                |___i18n/
                |     |___en-US.json
                |     |___fr-FR.json
                |     |___fr.json            
                |     |___ja-JP.json
                |     |___zh-Hans.json                
        </pre> 
    </section>
    <section id="sec-miniapp-processing" data-cite="infra">
      <h2>MiniApp Package Processing</h2>
        <p>
            [=User agents=] MUST follow the following algorithm to dereference, parse and execute a [=MiniApp package=]. 
        </p>
        <p>To <dfn>process a MiniApp package</dfn>, given [=URL=] |miniapp_uri:URL|, perform the following steps:</p>
        <ol class="algorithm">
            <li>Let |miniapp_zip_file:MiniApp ZIP container| be the result of [=retrieving a MiniApp ZIP container=] with |miniapp_uri|.</li>
            <li>[=Verify a MiniApp ZIP container=] with |miniapp_zip_file|.</li>
            <li>Let |miniapp_package:Miniapp package| be the result of unzipping the |miniapp_zip_file|.</li>
            <li>If |miniapp_package| is an unzip exception, then return failure.</li>
            <li>Let [=ordered map=] |manifest:ordered map| be the result of [=processing the MiniApp manifest=] with |miniapp_package|.</li>
            <li>Let |start_page:MiniApp start page| be the result of [=preparing the platform runtime=] with |miniapp_uri| and |manifest|.</li>
            <li>Let [=string=] |locale:string| be the result of [=extracting the locale=], passing |manifest|.</li>
            <li>Launch MiniApp passing |miniapp_package|, |manifest|, |start_page|, and |locale|.</li>
        </ol>

        <section id="sec-miniapp-processing-retrieval">
            <h3>MiniApp ZIP Container Retrieval</h3>
            <p>[=User agents=] MAY obtain [=MiniApp ZIP containers=] through different channels, retrieving the file over the network (i.e., using HTTPs, WebSocket, FTP, or other specific TCP/UDP based protocols), also from the filesystem or using any other mechanism.</p>
            <p>To <dfn data-lt="retrieving a MiniApp ZIP container" data-dfn-type="dfn">retrieve a MiniApp ZIP container</dfn>, given [=URL=] |miniapp_uri:URL|, perform the following steps. They return a [=MiniApp ZIP container=].</p>
            <ol class="algorithm">
                <li>Let |resource:MiniApp ZIP container| be a [=MiniApp ZIP container=] as a result of <a href="https://fetch.spec.whatwg.org/#concept-fetch">fetching a URL</a> [[FETCH]], passing |miniapp_uri|.</li>
                <li>Let |supplied_mime_type:string| be the result of applying the <a href="https://mimesniff.spec.whatwg.org/#supplied-mime-type-detection-algorithm">supplied MIME type detection algorithm</a> [[MIMESNIFF]] with |resource|.</li>
                <li>If |supplied_mime_type| is not equal to <code>application/miniapp-pkg+zip</code>, then return failure.</li>
                <li>Return |resource|.</li>
            </ol>
        </section>

        <section id="sec-miniapp-processing-verify">
            <h3>MiniApp ZIP Container Verification</h3>
            <p>[=User agents=] MAY guarantee the legitimacy and integrity of the [=MiniApp ZIP container=] and its content by verifying digital signatures and applying cryptographic mechanisms.</p>  
            <p>To <dfn data-lt="verifying a MiniApp ZIP container|Verify a MiniApp ZIP container">verify a MiniApp ZIP container</dfn>, given [=MiniApp ZIP container=] |miniapp_zip_file:MiniApp ZIP container|, perform the following steps:</p>
            <ol class="algorithm">
                <li>If the [=user agent=] has the capability to perform digital signature(s) verification of |miniapp_zip_file|, then: <br>
                    [=Process the digital signatures=] with |miniapp_zip_file|.
                </li>
            </ol>
            <section id="sec-miniapp-digital-signatures-processing">
                <h4>Digital Signatures Processing</h4>
                <p>The [=MiniApp ZIP container=] MAY contain a [=signing block=] that includes one or more signatures. The signing schemes and cryptographic mechanisms depend on the concrete implementation by [=user agents=].</p> 
                <p>Signing schemes are identified by the [=magic numbers=] section included in the [=MiniApp ZIP container=], a 16-byte sequence located immediately before the Central Directory of the ZIP package.</p>
                <p>To <dfn data-lt="processing the digital signatures|Process the digital signatures">process the digital signatures</dfn>, given [=MiniApp ZIP container=] |miniapp_zip_file:MiniApp ZIP container|, perform the following steps:</p>
                <ol class="algorithm">
                    <li>Let |magic_numbers:byte sequence| be a [=byte sequence=].</li>
                    <li>Let |eocd_pointer:byte sequence| be a [=byte sequence=] as the result of locating the byte sequence <code>0x06054b50</code> (read as little-endian) in |miniapp_zip_file| that marks the End of the Central Directory [[ZIP]].</li>
                    <li>Set |eocd_pointer| to |eocd_pointer| + 0x00000010.</li>
                    <li>Let |cd_pointer:byte sequence| be the result of reading the 4-byte sequence at |eocd_pointer|.</li>
                    <li>Let |magic_numbers_pointer:byte sequence| be |eocd_pointer| - 0x00000010.</li>
                    <li>Set |magic_numbers| to the 16-byte block at |magic_numbers_pointer|.</li>
                    <li>Process the digital signatures with |magic_numbers| and |miniapp_zip_file|.</li>
                </ol>
                <div class="note" title="Usage">
                    [=MiniApp user agents=] implement specific digital signature processing algorithms based on their needs and requirements.  
                </div>
                <aside class="example" title="Location of a digital signature within a MiniApp package">
                    <p>The [=MiniApp signing block=] may be encoded using any digital signature scheme that is identified by the 16-byte [=magic numbers=] block located just immediately before the Central Directory in the [=MiniApp ZIP container=]. As shown in the example in <a href="#figure-miniapp-location-magic-numbers"></a>, the End of Central Directory, identified by the values <code>0x06054b50</code>, contains the offset that enables [=user agents=] to identify the start of the Central Directory block, and subsequently the magic numbers at the end of the [=signing block=].</p>
                    <figure id="figure-miniapp-location-magic-numbers">
                        <img src="images/signature_bytes_central_directory.svg" alt="Location of the magic numbers within the MiniApp package" />
                        <figcaption>Example of End of Central Directory signature, location of the Central Directory and signature magic numbers</figcaption>
                    </figure>
                </aside>
            </section>
        </section>

        <section id="sec-miniapp-processing-manifest">
            <h3>MiniApp Manifest Processing</h3>
            <p>[=User agents=] MUST parse the <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a>, located in the [=MiniApp package=], that contains global metadata about the MiniApp.</p>  
            <p>To <dfn data-lt="processing the MiniApp manifest">process the MiniApp manifest</dfn>, given [=MiniApp Package=] |miniapp_package:MiniApp Package|, perform the following steps. They return [=ordered map=].</p>
            <ol class="algorithm">
                <li>If <code>manifest.json</code> file does not exist in the package's [=root directory=], then return failure.</li>
                <li>Let |manifest_json:ordered map| be the result of [=parse JSON from bytes=], passing <code>manifest.json</code>.</li>
                <li>If |manifest_json| is a parsing exception, or |manifest_json| is not an [=ordered map=], then return failure.</li>
                <li>Let |manifest:ordered map| be an [=ordered map=].</li>
                <li><a href="https://www.w3.org/TR/miniapp-manifest/#dfn-processing-a-miniapp-manifest" data-link-type="dfn">Process a MiniApp manifest</a>, passing |manifest_json| and |manifest|.</li>
                <li>Return |manifest|.</li>
            </ol>
        </section>

        <section id="sec-miniapp-platform-runtime-preparation">
            <h3>Platform Runtime Preparation</h3>
            <p>[=User agents=] SHOULD prepare the runtime environment that contains both the logic and the view layers. The logic layer is responsible for logic and control of the application (i.e., <code>app.js</code>, and <code>page.js</code> files). The view layer is responsible for the visual environment and rendering, including the page resource files, such as component templates and stylesheets. In preparation for running a MiniApp, [=user agents=] MUST set up the environment with the configuration specified by the <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a> metadata.</p>
            <p>[=User agents=] MUST identify and load the [=start page=] as the MiniApp entry point, according to the following algorithm.</p>
            <p>To <dfn data-lt="preparing the platform runtime">prepare the platform runtime</dfn>, given [=URL=] |miniapp_uri:URL| and [=ordered map=] |manifest:ordered map|, perform the following steps. They return a [=MiniApp start page=].</p>
            <ol class="algorithm">
                <li>If <code>app.js</code> does not exist in the [=root directory=], then return failure.</li>
                <li>If <code>app.css</code> does not exist in the [=root directory=], then return failure.</li>
                <li>[=Verify platform compatibility=], passing |miniapp_package| and |manifest|.</li>
                <li>Let |start_page:URL| be the result of [=determining the start page=], passing |miniapp_package|, |miniapp_uri| and |manifest|.</li>
                <li>Return |miniapp_uri|.</li>
            </ol>
            <section id="sec-miniapp-platform-compatibility-verification">
                <h4>Platform Compatibility Verification</h4>
                <p>[=User agents=] MUST verify that a [=MiniApp=] is compatible with them and can run properly in their platform. This verification is performed using the metadata specified in the <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a>, including the supported version of the platform and checking the pages and resources needed in the execution.</p>
                <p>To <dfn data-lt="Verify platform compatibility">verify platform compatibility</dfn>, given [=MiniApp Package=] |miniapp_package:MiniApp Package| and [=ordered map=] |manifest:ordered map|, perform the following steps:</p>
                <ol class="algorithm">
                    <li>Set |platform_required:ordered map| to |manifest|["platform_version"].</li>
                    <li>If |platform_required| is not compatible with the [=user agent=] configuration, then return failure.</li>
                    <li>[=list/For each=] |page:URL| of [=list=] |manifest|["pages"]:
                        <ol>
                            <li>If |page| does not exist in the |miniapp_package|, return failure.</li>
                        </ol>
                    </li>
                    <li>If |manifest|["widgets"] [=map/exists=], then:<br>
                        [=list/For each=] |widget_path:URL| of [=list=] |manifest|["widgets"]:
                        <ol>
                            <li>If |widget_path| does not exist in the |miniapp_package|, return failure.</li>
                        </ol>
                    </li>
                </ol>                
            </section>
            <section id="sec-miniapp-platform-start-page-identification">
                <h4>Start Page Identification</h4>
                <p>By default, [=user agents=] MUST load the [=start page=] indicated in the <a href="https://www.w3.org/TR/miniapp-manifest/#dfn-miniapp-manifest-s" data-link-type="dfn">MiniApp manifest</a> as the entry point when the MiniApp is launched. This [=start page=] by default MUST be overridden if a valid [=page=] is specified in the MiniApp URI, as specified in the following algorithm.</p>
                <p >To <dfn data-lt="determining the start page">determine the start page</dfn>, given [=MiniApp Package=] |miniapp_package:MiniApp Package|, [=URL=] |miniapp_uri:URL|, and [=ordered map=] |manifest:ordered map|, perform the following steps. They return a [=URL=].</p>
                <ol class="algorithm">
                    <li>Let |start_page:URL| be the result of [=extracting the start page from URI=], passing |miniapp_uri|.</li>
                    <li>If |start_page| is not set, or if |start_page| is equal to null, or if |start_page| does not exist in |miniapp_package|, then:<br>
                        Set |start_page| to the result of [=extracting the start page from manifest=], passing |manifest|.
                    </li>
                    <li>Return |start_page|</li>
                </ol>  
                <section id="sec-miniapp-processing-platform-start-page-uri">
                    <h5>Extraction of Start Page From URI</h5>
                    <p>MiniApp URIs MAY contain information about the [=start page=], specified as the [=URL-path-segment string=] of the URI.</p>
                    <p>To <dfn data-lt="extracting the start page from URI">extract the start page from URI</dfn>, given [=URL=] |miniapp_uri:URL|, perform the following steps. They return a [=URL=].</p>
                    <ol class="algorithm">
                        <li>Let |start_page:URL| be the [=URL-path-segment string=] resulting of [=URL Parser|parse=] |miniapp_uri:URL|.</li>
                        <li>If |start_page| is failure, return null.</li> 
                        <li>Return |start_page|.</li>
                    </ol>                     
                </section>
                <section id="sec-miniapp-processing-platform-start-page-manifest">
                    <h5>Extraction of Start Page From Manifest</h5>
                    <p>As described in the <a href="https://www.w3.org/TR/miniapp-manifest/#pages-member">MiniApp Manifest's <code>pages</code> member</a> [[MINIAPP-MANIFEST]], the [=start page=] of a MiniApp is specified in the first item of the <code>pages</code> [=list=].</p>
                    <p>To <dfn data-lt="extracting the start page from manifest">extract the start page from manifest</dfn>, given [=ordered map=] |manifest:ordered map|, perform the following steps. They return a [=string=].</p>
                    <ol class="algorithm">
                        <li>Let |start_page_id| be the empty [=string=].</li>
                        <li>Let [=list=] |pages:list| be |manifest|["pages"].</li>
                        <li>Return |pages|[0].</li>
                    </ol>
                </section>
            </section>
            <section id="sec-miniapp-processing-locale">
                <h4>Extraction of Locale</h4>
                <p>To <dfn data-lt="extracting the locale">extract the locale</dfn>, given [=ordered map=] |manifest:ordered map|, perform the following steps. They return a [=string=].</p>
                <ol class="algorithm">
                    <li>Let [=string=] |locale:string| be the [=user agent=]'s default locale.</li>
                    <li>If |manifest|["lang"] [=map/exists=], and if |manifest|["lang"] is supported by the [=user agent=], then: <br>
                        Set |locale| to |manifest|["lang"].
                    <li>Return |locale|.</li>
                </ol>
            </section>                
        </section>
    </section>         
    <section id="sec-security-privacy">
        <h2>Security and Privacy Considerations</h2>
        <section>
            <h3>Package Integrity and Trustworthiness</h3>
            <p>To ensure the integrity and trustworthiness within the distribution stage of MiniApps, a [=MiniApp package=] SHOULD be protected by one or more [=digital signatures=]. These signatures, along with certificates issued by trusted authorities, could help third parties to validate the authorship of the MiniApp (e.g. the MiniApp developer), and other entities involved in the development or distribution of the software (e.g., an application store as MiniApp distributor).</p>
            <p>The usual scenarios where digital signatures are included in MiniApps are, but not limited to:</p> 
            <ul>  
                <li>A digital signature (with a valid certificate) of the author that ensures the origin of the MiniApp, which gives a recipient strong reason to believe that this package was created by a known sender (authentication) and that the message was not altered in transit (integrity). Thus, an end-user or a hosting platform can decide whether to install the [=MiniApp package=] depending on the status and quality of the author (e.g., credits, blocklist, certifications, etc.).</li>
                <li>Distributors’ signatures (for example, official marketplace signatures), which are used to ensure the trustworthiness of the delivery channel. This kind of signature protects end-users from tampering activities and ensures a healthy ecosystem of applications. </li>
            </ul>
            <p>No specific digital signature mechanism, cryptographic technology, or algorithm is recommended in this specification. MiniApp vendors MAY or MAY NOT implement digital signature mechanisms, according to their use cases. When implemented, the <a href="#sec-miniapp-digital-signature-requirements"></a> shall be followed.</p>

            <p>Some examples of technologies and encryption methods are introduced in the <a href="#sec-signature-schemes"></a>.</p>

        </section>
        <section>
            <h3>Content Confidentiality</h3>
            <p>This specification does not recommend any encryption mechanism for the [=MiniApp package=] to protect its confidentiality. However, it doesn't preclude an implementation from deploying some encryption mechanism for special purposes.</p>
        </section>
    </section>    

    <section class="appendix informative" id="sec-acknowledgments">
        <h2>Acknowledgments</h2>
		<div class="ednote">List all the contributors and W3C Team contacts</div>
    </section>
    <section class="appendix informative" id="sec-signature-schemes">
        <h2>Signature Schemes</h2>

        <p>Every [=user agent=] MAY support its own digital signature schemes depending on their needs. This section includes some examples of digital signature implementations as illustrated in <a href="#figure-miniapp-signatures-example"></a>. They can be used in specific scenarios, such as developer verification and integrity of a MiniApp during its distribution.</p>   

                  
            <figure id="figure-miniapp-signatures-example">
                <img src="images/signature_zip_example.svg" alt="Example of signing blocks with different signature scheme in the MiniApp package" />
                <figcaption>Example of different signature methods included in the MiniApp package</figcaption>
            </figure>

        <section  id="sec-signature-rpk">
            <h3>RPK Signature Scheme</h3>
            <p>As one implementation of MiniApp, <a href="https://www.quickapp.cn/" hreflang="zh">Quick Apps</a> use a so-called RPK (Runnable Package) Signature Scheme, which is similar to the APK Signature Scheme v2 [[?APK-SIGNATURE-V2]], to verify the authorship of the [=MiniApp package=]. This signature scheme takes every byte in a MiniApp package into the signature generation. The resulting [=signing block=] is created and inserted into the package file, according to the <a href="#sec-miniapp-digital-signature-requirements">Digital Signature Requirements</a>.</p>
            <p>The [=signing block=] contains ID-value pairs with information about the signature and the signer identity.</p> 
          
             <p class="note">All data values in the RPK [=signing block=] are represented in little-endian format, and all length-prefixed fields use <code>uint32</code> for length.</p>
            
            <p>The description  uses the following basic data types:</p>
            <dl>
                <dt>uint64</dt>
                <dd>64-bit (8-byte) unsigned integer in little-endian format</dd>
                <dt>uint32</dt>
                <dd>32-bit (4-byte) unsigned integer in little-endian format</dd>
            </dl>

            <h4>Signing Block Format</h4>
            <p>The format of the RPK signing block is as follows:</p>
            <ul>
                <li><strong>block size</strong> in bytes, excluding this field (uint64)</li>
                <li>Sequence of ID-value pairs (where the <a href="#sec-signing-block-signature">Signatures</a> are defined):
                    <ul>
                        <li><strong>size</strong> of ID-value pair (uint64)</li> 
                        <li><strong>ID</strong> (uint32)</li>
                        <li><strong>value</strong> (size of ID-value pair - 4 bytes)</li>
                    </ul>
                </li>
                <li><strong>block size</strong> in bytes (the same as first field) (uint64)</li>
                <li><strong>magic numbers</strong> “<code>RPK Sig Block 42</code>” (16 bytes)</li>
            </ul>

            <p>ID-value pairs with unknown IDs should be ignored when interpreting the block.</p>
            <p>The "block size" value enables locating the start of the signing block in the whole ZIP file.</p>
                
            <section id="sec-signing-block-signature">
                <h5>Signatures</h5>
                <p>The signatures are stored as <strong>ID-value pairs</strong> with specific identifiers that represent the types of the signature. The supported signatures, and associated IDs, for RPK packages are described in the following sub-clauses.</p>
                
                <p class="ednote" title="package-splitting"> There are cases where a MiniApp package is split into multiple sub-packages (by a distribution platform e.g. an app-store) for the user agent to download and execute it in a progressive fashion to improve the user experience. In such a case, additional signature types (thus IDs) would be needed to ensure the integrity of each sub-package as well as the whole. Details are for further study.</p>
                <section>
                    <h6>Developer Signature</h6>
                    <p>The ID-value pair in the signing block under ID <code>0x01000101</code> represents the data of the signature of the whole-file [=MiniApp package=].</p>
                    <p>The value of the ID-pair contains all the signature blocks and it has a variable length and its structure is as follows:</p>
                    <ul>
                        <li><strong>ID</strong>: <code>0x01000101</code> (uint32)</li>
                        <li><strong>value</strong>:
                            <ul>
                                <li><strong>size</strong> of signer blocks, excluding this field (uint32)</li>
                                <li>Sequence of <strong>signer blocks</strong>:
                                    <ul>
                                        <li><strong>size</strong> of signer block, excluding this field (uint32)</li>
                                        <li><strong>signed data</strong>:
                                            <ul>
                                                <li><strong>size</strong> of digests, excluding this field (uint32)</li>
                                                <li>Sequence of <strong>digests</strong>:
                                                    <ul>
                                                        <li><strong>size</strong> of digest block, excluding this field (uint32)</li>                                                
                                                        <li><strong>signature algorithm ID</strong> (uint32)</li>
                                                        <li><strong>size</strong> of digest content, excluding this field (uint32)</li>                                                
                                                        <li><strong>digest</strong> content (variable length)</li>
                                                    </ul>
                                                </li>
                                                <li><strong>size of certificates</strong>, excluding this field (uint32)</li>
                                                <li>Sequence of <strong>certificates</strong>:
                                                    <ul>
                                                        <li><strong>size</strong> of certificate, excluding this field (uint32)</li>
                                                        <li><strong>X.509 certificate</strong> [[?rfc2528]] in <abbr title="Abstract Syntax Notation One">ASN.1</abbr> <abbr title="Distinguished Encoding Rules">DER</abbr> form [[?X690]] (variable length)</li>
                                                    </ul>
                                                </li>
                                                <li><strong>size</strong> of additional attributes, excluding this field (uint32)</li>                                                        
                                                <li><strong>additional attributes</strong></li>
                                            </ul>
                                        <li><strong>size</strong> of signatures, excluding this field (uint32)</li>
                                        <li>Sequence of <strong>signatures</strong>:
                                            <ul>
                                                <li><strong>size</strong> of signature, excluding this field (uint32)</li>
                                                <li><strong>signature algorithm ID</strong> (uint32)</li>
                                                <li><strong>size</strong> of signature content, excluding this field (uint32)</li>
                                                <li><strong>signature content</strong> (variable length)</li>
                                            </ul>
                                        <li><strong>size</strong> of public key, excluding this field (uint32)</li>                                                    
                                        <li><strong>public key</strong> in <abbr title="Abstract Syntax Notation One">ASN.1</abbr> <abbr title="Distinguished Encoding Rules">DER</abbr> [[?X690]] form (variable length)</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </section>
                <section>
                    <h6>Distributor Signature</h6>
                    <p>The signature of the distributor preserves the integrity of the application during the distribution process, guaranteeing that the package is verified by the trusted distributor and the permission control policy (in the form of a <dfn id="dfn-provisioning-profile" data-dfn-type="dfn">provisioning profile</dfn>) from the distributor is enforced upon the package.</p>

                    <p>During the process of distributor signing, either the distributor or the developer adds a [=Provisioning Profile=] and uses the private key of the distributor to sign the signature.</p>
                    <p>The [=Provisioning Profile=] is stored in the ID-value pair of the signing block under ID <code>0x02000201</code>.</p>
                    <p>The value of the ID-pair contains all its signature blocks and it has a variable length and its structure is as follows:</p>
                    <ul>
                        <li><strong>ID</strong>: <code>0x02000201</code> (uint32)</li>
                        <li><strong>value</strong>:
                            <ul>
                                <li><strong>size</strong> of signer block, excluding this field (uint32)</li>
                                <li><strong>signer block</strong>:
                                    <ul>
                                        <li><strong>size</strong> of the [=Provisioning Profile=], excluding this field (uint32)</li>
                                        <li><strong>provisioning profile</strong>. Sequence of the provisioning profile ID-value pairs, according to the <a href="#sec-provisioning-profile-id">provisioning profile IDs</a>:
                                            <ul>
                                                <li><strong>size</strong> of ID-value pair, excluding this field (uint32)</li>
                                                <li><strong>ID</strong> (uint32)</li>
                                                <li><strong>value</strong> (variable length)</li>
                                            </ul>
                                        </li>
                                        <li><strong>size</strong> of signature, excluding this field (uint32)</li>
                                        <li><strong>signature algorithm ID</strong> according to the values of <a href="#sec-signature-algorithm-id">Signature Algorithm IDs</a> (uint32)</li>
                                        <li><strong>size</strong> of signature content, excluding this field (uint32)</li>
                                        <li><strong>signature content</strong> (variable length)</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <h6 id="sec-signature-algorithm-id">Signature Algorithm IDs</h6>
                    <ul>
                        <li><code>0x0101</code> RSASSA-PSS with SHA2-256 digest, SHA2-256 MGF1, 32 bytes of salt, trailer: 0xbc</li>
                        <li><code>0x0102</code> RSASSA-PSS with SHA2-512 digest, SHA2-512 MGF1, 64 bytes of salt, trailer: 0xbc</li>
                        <li><code>0x0103</code> RSASSA-PKCS1-v1_5 with SHA2-256 digest. This is for build systems which require deterministic signatures.</li>
                        <li><code>0x0104</code> RSASSA-PKCS1-v1_5 with SHA2-512 digest. This is for build systems which require deterministic signatures.</li>
                        <li><code>0x0201</code> ECDSA with SHA2-256 digest</li>
                        <li><code>0x0202</code> ECDSA with SHA2-512 digest</li>
                        <li><code>0x0301</code> DSA with SHA2-256 digest</li>
                    </ul>
                    <h6 id="sec-signature-key-sizes">Supported keys sizes and <abbr title="elliptic-curve">EC</abbr> cryptography:</h6>
                    <ul>
                        <li><strong>RSA</strong>: 1024, 2048, 4096, 8192, 16384</li>
                        <li><strong>EC</strong>: NIST P-256, P-384, P-521</li>
                        <li><strong>DSA</strong>: 1024, 2048, 3072</li>
                    </ul>
                    <h6 id="sec-provisioning-profile-id">Provisioning Profile IDs</h6>
                    <ul>
                        <li><code>0x01</code> Certificate Digest
                            <ul>
                                <li><strong>size</strong> of certificate digest block, excluding this field (uint32)</li>
                                <li><strong>signature algorithm ID</strong> according to the values of <a href="#sec-signature-algorithm-id">Signature Algorithm IDs</a> (uint32)</li>
                                <li><strong>size</strong> of certificate digest data, excluding this field (uint32)</li>
                                <li><strong>certificate digest data</strong> (variable length)</li>
                            </ul>
                        </li>
                        <li><code>0x02</code> Certificate
                            <ul>
                                <li><strong>size</strong> of certificate, excluding this field (uint32)</li>
                                <li><strong>certificate data</strong> in <abbr title="Abstract Syntax Notation One">ASN.1</abbr> <abbr title="Distinguished Encoding Rules">DER</abbr> [[?X690]] form (variable length)</li>
                            </ul>
                        </li>
                        <li><code>0x03</code> Usage:
                            <ul>
                                <li><strong>app store</strong>, value: <code>0x01</code></li>
                                <li><strong>debug</strong>, value: <code>0x02</code></li>
                                <li><strong>enterprise</strong>, value: <code>0x03</code></li>
                            </ul>
                        </li>
                        <li><code>0x04</code> Manifest
                            <ul>
                                <li><strong>size</strong> of manifest, excluding this field (uint32)</li>
                                <li><strong>manifest</strong> in UTF-8 [[UNICODE]] (variable length)</li>
                            </ul>
                        </li>
                        <li><code>0x05</code> Device IDs
                            <ul>
                                <li><strong>size</strong> of Device IDs, excluding this field (uint32)</li>
                                <li>Sequence of <strong>Device IDs</strong>:
                                    <ul>
                                        <li><strong>size</strong> of Device ID, excluding this field (uint32)</li>
                                        <li><strong>Device ID</strong>, represented in MD5 format [[?rfc1321]] (variable length)</li> 
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </section>            
            </section>
        </section>
        <section  id="sec-signature-pkcs7">
            <h3>PKCS#7 Signature Scheme</h3>
            <p>This signature scheme is based on the PKCS #7 Cryptographic Message Syntax [[?rfc2315]]. It MAY cover different stages of packaging signature described in <a href="#sec-signature-rpk">RPK Signature Scheme</a>, including the developer signature and distributor signature.</p>
            <p>This signature scheme includes the [=Provisioning Profile=] of the MiniApp and the developer's signature at the first stage (developer signing stage). At the second stage (distributor signing stage), a distributor MAY replace the developer's signature with the its own signature. Like the <a href="#sec-signature-rpk">RPK Signature Scheme</a>, this approach generates a signing block to be included into the package file, according to the <a href="#sec-miniapp-digital-signature-requirements">Digital Signature Requirements</a>.</p>

            <p>The PKCS#7 signing block is defined as a data container that includes the block with the digital signature, data encrypted using the PKCS #7 syntax that contains the signatures and the signer identity.</p>
    
            
            <p>The description  uses the following basic data types:</p>
            <dl>
                <dt>uint64</dt>
                <dd>64-bit (8-byte) unsigned integer</dd>
                <dt>uint32</dt>
                <dd>32-bit (4-byte) unsigned integer</dd>
                <dt>uint16</dt>
                <dd>16-bit (2-byte) unsigned integer</dd>
            </dl>

            <h4>Signing Block Format</h4>
            <p>The format of the PKCS#7 signing block is as follows:</p>
            <ul>
                <li id="pkcs7-profile-block-head"><strong>Signing block head</strong>
                    <ul>
                        <li><strong>type</strong> to indicate the type, according to <a href="#types-signing-blocks">Types of signing blocks</a> (1 byte)</li>
                        <li><strong>tag</strong> to indicate the sub-type, according to <a href="#types-signing-blocks">Types of signing blocks</a> (1 byte)</li>
                        <li><strong>length</strong> (uint16)</li>
                        <li><strong>offset</strong> (uint32)</li>
                    </ul>                    
                </li>
                <li>Signature Block head:
                    <ul>
                        <li><strong>reserved</strong> (4 bytes)</li>
                        <li><strong>number of blocks</strong> (uint32)</li>
                        <li><strong>size</strong> (uint32)</li>
                        <li><strong>version</strong> (4 bytes)</li>
                        <li><strong>magic numbers</strong> “<code>MIX Sig Block 42</code>” (16 bytes)</li>
                    </ul>
                </li>
                <li><strong>Data</strong></li>
                <li><strong>Signature Block data</strong> in PKCS #7:
                    <ul>
                        <li>PKCS #7 Content Type set to <code>SignedData</code>:
                            <ul>
                                <li><strong>version</strong>: syntax version number</li>
                                <li><strong>digest algorithms</strong>: a collection of message-digest algorithm identifiers</li>
                                <li>The content that is signed:
                                    <ul>
                                        <li><strong>version</strong> (uint32)</li>
                                        <li><strong>size</strong> (uint16)</li>
                                        <li><strong>number of blocks</strong> (uint16)</li>
                                        <li><strong>Content Hash</strong>:
                                            <ul>
                                                <li><strong>type</strong> (uint8)</li>
                                                <li><strong>tag</strong> (uint8)</li>
                                                <li><strong>algorithm ID</strong> (uint8)</li>
                                                <li><strong>length</strong> (uint32)</li>
                                                <li><strong>hash</strong> (variable length)</li>
                                            </ul>  
                                        </li>
                                    </ul> 
                                </li>
                                <li><strong>certificates</strong>: a set of PKCS #6 extended certificates and X.509 certificates</li>
                                <li><strong>crls</strong>: a set of certificate-revocation lists</li>
                                <li><strong>signerInfos</strong>: a collection of per-signer information</li>
                            </ul>
                        </li>
                        <li>Signer</li>
                    </ul>
                </li>
                <li>Hw sign head:
                    <ul>
                        <li><strong>number of blocks</strong> (uint32)</li>
                        <li><strong>size</strong> (uint32)</li>
                        <li><strong>version</strong> (4 bytes)</li>
                        <li><strong>magic numbers</strong> “<code>MIX Sig Block 42</code>” (16 bytes)</li>
                    </ul>
                </li>
            </ul>

            <h5 id="types-signing-blocks">Types of Signing Blocks</h5>
            <p>The type of the <a href="#pkcs7-profile-block-head">Block Head</a> is identified by its attribute <code>type</code>. This attribute MUST take two different values:</p>
            <ul>
                <li><code>0</code> for File Signature blocks</li>
                <li><code>1</code> for [=Provisioning Profile=] blocks</li>
            </ul>
            <p>If the value of type is set to <code>0</code> (File Signature block), the header MUST specify a narrower subtype, using the attribute <code>tag</code> in its <a href="#pkcs7-profile-block-head">Block Head</a>. The values for this subtype are:</p>
            <ul>
                <li><code>0</code>: Default</li>
                <li><code>1</code>: HASH (Whole file hash)</li> 
                <li><code>0x80</code>: 1M_HASH_ROOT (1M block hash tree, root hash)</li>
                <li><code>0x81</code>: 512K_HASH_ROOT (512K block hash tree, root hash)</li>
                <li><code>0x82</code>: 256K_HASH_ROOT (256K block hash tree, root hash)</li>
                <li><code>0x83</code>: 128K_HASH_ROOT (128K block hash tree, root hash)</li>
                <li><code>0x84</code>: 64K_HASH_ROOT (64K block hash tree, root hash)</li>
                <li><code>0x85</code>: 32K_HASH_ROOT (32K block hash tree, root hash)</li>
                <li><code>0x86</code>: 16K_HASH_ROOT (16K block hash tree, root hash)</li>	
                <li><code>0x87</code>: 8K_HASH_ROOT (8K block hash tree, root hash)</li>
                <li><code>0x88</code>: 4K_HASH_ROOT (4K block hash tree, root hash)</li>
                <li><code>0x90</code>: 1M_HASH_BLOCK (1M block hash tree)</li>
                <li><code>0x91</code>: 512K_HASH_BLOCK (512K block hash tree)</li>
                <li><code>0x92</code>: 256K_HASH_BLOCK (256K block hash tree)</li>
                <li><code>0x93</code>: 128K_HASH_BLOCK (128K block hash tree)</li>	
                <li><code>0x94</code>: 64K_HASH_BLOCK (64K block hash tree)</li>	
                <li><code>0x95</code>: 32K_HASH_BLOCK (32K block hash tree)</li>
                <li><code>0x96</code>: 16K_HASH_BLOCK (16K block hash tree)</li>	
                <li><code>0x97</code>: 8K_HASH_BLOCK (8K block hash tree)</li>
                <li><code>0x98</code>: 4K_HASH_BLOCK (4K block hash tree)</li>                
            </ul>
        </section>            
    </section>

<section class="appendix informative" id="sec-media-type-registration">
        <h2>Media Type Registration</h2>
        <p>This appendix registers the <code>application/miniapp-pkg+zip</code> media type for MiniApp packages, in conformance with BCP 13 [[RFC4289]] and <a href="https://www.w3.org/2020/01/registering-mediatypes.html">Register an Internet Media Type for a W3C Spec</a>.</p>

        <p>A [=MiniApp package=] file is a container technology based on the [[ZIP]] archive format, including some modifications.</p> 

        <dl>
            <dt>Type name:</dt>
            <dd><code>application</code></dd>
            <dt>Subtype name:</dt>
            <dd><code>miniapp-pkg+zip</code></dd>
            <dt>Required parameters:</dt>
            <dd>"N/A"</dd>
            <dt>Optional parameters:</dt>
            <dd>"N/A"</dd>
            <dt>Encoding considerations:</dt>
            <dd>MiniApp packages are binary files encoded in the <a href="https://www.iana.org/assignments/media-types/application/zip">application/zip</a> media type. See <a href="https://datatracker.ietf.org/doc/html/rfc6839#section-3.6">RFC 6839, section 3.6</a> [[RFC6839]].</dd>
            <dt>Security considerations:</dt>
            <dd>Security considerations that apply to application/zip also apply to MiniApp package files. User agents that process MiniApp package files should rigorously check the size and validity of data retrieved. When digital signatures are available in a MiniApp package file, the user agent SHOULD implement necessary mechanisms to check the integrity and trustworthiness of the file according to the digital signatures, so as to to protect the end user and the hosting platform from the damage of package tampering or corruption. See more at [[[#sec-security-privacy]]].</dd>
            <dt>Interoperability considerations:</dt>
            <dd>The file, after including the signature, is not a standard ZIP but the inclusion does not affect parsing and operation of the file as a ZIP file.</dd>
            <dt>Published specification:</dt>
            <dd>This media type registration is for the MiniApp package, as described in the specification located at <a href="https://www.w3.org/TR/miniapp-packaging/">https://www.w3.org/TR/miniapp-packaging/</a>.</dd>
            <dt>Applications that use this media type:</dt>
            <dd>This media type is used for the distribution of MiniApps. The list, non exhaustive, of applications and software platforms that (intend to) support this media type are:
            <ul>
                <li><a href="https://mp.360.cn/" hreflang="zh">360 Mini Programs</a></li>
                <li><a href="https://open.alipay.com/channel/miniIndex.htm" hreflang="zh">Alipay Mini Apps</a></li>
                <li><a href="https://smartprogram.baidu.com/developer/index.html" hreflang="zh">Baidu Smart Programs</a></li>
                <li><a href="https://www.quickapp.cn/" hreflang="zh">Quick Apps</a></li>
            </ul>
            <span class="ednote" title="To update the supporting applications">
                The listed applications above are the base technologies to develop this spec. They are not using the proposed media type yet, but will potentially support it when the spec is ready. The list shall be confirmed/updated later.
            </span>
            </dd>
            <dt>Fragment identifier considerations:</dt>
            <dd>"N/A"</dd>
            <dt>Additional information:</dt>
            <dd>
                <dl>
                    <dt>Deprecated alias names for this type:</dt>
                    <dd>"N/A"</dd>
                    <dt>Magic number(s):</dt>
                    <dd>50 4B 03 04</dd>
                    <dt>File extension(s):</dt>
                    <dd>MiniApps are usually identified with the extension <code>.ma</code>.</dd>
                    <dt>Macintosh file type code(s):</dt>
                    <dd>ZIP</dd>
                </dl>
            </dd>
            <dt>Person & email address to contact for further information:</dt>
            <dd>The <a href="https://www.w3.org/2021/miniapps/" rel="nofollow">MiniApps Working Group</a> can be contacted at <a href= "https://lists.w3.org/Archives/Public/public-miniapps-wg/" rel= "nofollow">public-miniapps-wg@w3.org</a>.</dd>
            <dt>Intended usage:</dt>
            <dd>COMMON</dd>
            <dt>Restrictions on usage:</dt>
            <dd>"N/A"</dd>
            <dt>Author:</dt>
            <dd>The MiniApp Packaging defines a file format developed by the W3C MiniApp Working Group.</dd>
            <dt>Change controller:</dt>
            <dd>W3C is the controller for the MiniApp Packaging specification</dd>
            <dt>Provisional registration?:</dt>
            <dd>"N/A"</dd>                      
        </dl>
        <div class="issue" data-number="4">This section needs to specify the technical details for the MIME type registration (like the extension).</div> 
        <p class="note">
            A temporary solution could be <code>application/x-w3c-miniapp-pkg+zip</code> for the sake of any early implementation.
        </p>

        <p class="issue">Should processors check the integrity of the package (Security considerations section)?</p>

    </section>    

</body>

</html>
